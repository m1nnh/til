## :star:  SQL APPLICATION

### :speech_balloon: 표준 조인

#### 1. STANDARD SQL 개요
- UNION 연산은 수학적 합집합을 제공하기 위해, 공동 교집합의 중복을 없애기 위한 사전 작업으로 시스템에 부하를 주는 정렬 작업이 발생한다.
- Intersection은 수학의 교집합으로써 두 집합의 공동집합을 추출한다.
- Difference는 수학의 차집합으로써 첫 번째 집합에서 두 번째 집합과의 공통집합을 제외한 부분이다.
- Product는 곱집합으로 Join 조건이 없는 경우 생길 수 있는 모든 데이터 조합을 말한다.

#### 2. FROM 절 JOIN 형태
- WHERE 절의 JOIN 조건을 FROM 절의 ON 조건절로 분리하여 표시함으로써 사용자가 이해하기 쉽도록 한다.

#### 3. INNER JOIN
- INNER JOIN은 OUTER JOIN과 대비하여 내부 JOIN이라고 하며 JOIN 조건에서 동일한 값이 있는 행만 반환한다.

#### 4. NATURAL JOIN
- NATURAL JOIN은 두 테이블 간의 동일한 이름을 갖는 모든 칼럼들에 대해 EQUI JOIN을 수행한다.

#### 5. USING 조건절
- USING 조건절을 이용하면 같은 이름을 가진 칼럼들 중에서 원하는 칼럼에 대해서만 선택적으로 EQUI JOIN을 할 수가 있다.

#### 6. ON 조건절
- JOIN 서술부(ON 조건절)와 비 JOIN 서술부(WHERE 조건절)를 분리하여 이해가 쉬우며, 칼럼명이 다르더라도 JOIN 조건을 사용할 수 있는 장점이 있다.

#### 7. CROSS JOIN
- PRODUCT의 개념으로 테이블 간 JOIN 조건이 없는 경우 생길 수 있는 모든 데이터의 조합을 말한다.

#### 8. OUTER JOIN
- 내부 조인과 대비하여 외부 조인이라고 불리며 조인 조건에서 동일한 값이 없는 행도 반환할 때 사용할 수 있다.
- LEFT OUTER JOIN : 조인 수행시 먼저 표기된 좌측 테이블에 해당하는 데이터를 먼저 읽은 후, 나중 표기된 우측 테이블에서 조인 대상 데이터를 읽어 온다. 즉 Table A와 B가 있을 때 A가 기준
- RIGHT OUTER JOIN : A와 B가 있을 때 B가 기준
- FULL OUTER JOIN : 조인 수행시 좌측, 우측 테이블의 모든 데이터를 읽어 조인하여 결과를 생성한다. 결국 둘다 기준이 된다. 단 중복 되는 데이터는 삭제한다.

### :speech_balloon: 집합 연산자

- 두 개 이상의 테이블에서 조인을 사용하지 않고 연관된 데이터를 조회하는 방법 중에 또 다른 방법이 있는데 그 방법이 바로 집합 연산자를 사용하는 방법이다.
- 집합 연산자를 사용하는 상황은 서로 다른 테이블에서 유사한 형태의 결과를 반환하는 것을 하나의 결과로 합치고자 할 때와 동일 테이블에서 서로 다른 질의를 수행하여 결과를 합치고자 할 때 사용할 수 있다.
- 집합 연산자 종류
    - UNION/UNOIN ALL(합집합) -> ALL을 붙이면 중복 숫자도 나오게함
    - INTERSECTION(교집합)
    - EXCEPT(차집합)
    
### :speech_balloon: 계층형 질의와 셀프 조인

#### 1. 계층형 질의
- 테이블에 계층형 데이터가 존재하는 경우 데이터를 조회하기 위해서 계층형 질의를 사용한다.
- 계층형 데이터란 동일 테이블에 계층적으로 상위와 하위 데이터가 포함된 데이터를 말한다.
- Oracle 계층형 질의
    - Prior 자식 = 부모 -> 자식에서 부모 방향으로 전개하는 순방향 전개 방식
    - Prior 부모 = 자식 -> 부모에서 자식 방향으로 전개하는 역방향 전개 방식
    - NOCYCLE : 데이터를 전개하면서 이미 나타났던 동일한 데이터가 전개 중에 다시 나타난다면 이것을 가리켜 사이클이 형성 되었다고 말한다. -> NOCUCLE을 추가하면 사이클이 발생한 이후의 데이터는 전개하지 않는다.
    - ORDER SIBLINGS BY : 형제 노드 사이에서 정렬을 수행한다.
- 계층형 질의에서 사용되는 가상 칼럼
    - LEVEL : 루트 데이터면 1, 그 하위 데이터이면 2이다. 리프 데이터까지 1씩 증가한다.
    - CONNECT_BY_ISLEAF : 전개 과정에서 해당 데이터가 리프 데이터면 1 그렇지 않으면 0이다.
    - CONNECT_BY_ISCUCLE : 전개 과정에서 자식을 갖는데, 해당 데이터가 조상으로서 존재하면 1 그렇지 않으면 0이다. 여기서 조상이란 자신으로부터 루트까지의 경로에 존재하는 데이터를 말한다. CYCLE 옵션을 사용했을 때만 사용할 수 있다.
- 계층형 질의에서 사용되는 함수
    - SYS_CONNECT_BY_PATH : 루트 데이터부터 현재 전개할 데이터까지의 경로를 표시한다. (SYS_CONNECT_BY_PATH(칼럼, 경로분리자))
    - CONNECT_BY_ROOT : 현재 전개할 데이터의 루트 데이터를 표시한다. 단항 연산자이다. (CONNECT_BY_ROOT 칼럼)

- SQL Server 계층형 질의
    - CTE 식을 앵커 맴버와 재귀 맴버로 분할한다.
    - 앵커 맴버를 실행하여 첫 번째 호출 또는 기본 결과 집합(T0)을 만든다.
    - Ti는 입력으로 사용하고 Ti+1은 출력으로 사용하여 재귀 맴버를 실행한다.
    - 빈 집합이 반환될 때까지 3단계를 반복한다.
    - 결과 집합을 반환한다

#### 2. 셀프 조인
- 셀프 조인이란 동일 테이블 사이의 조인을 말한다. 따라서 FROM 절에 동일 테이블이 두 번 이상 나타난다.
- 동일 테이블 사이의 조인을 수행하면 테이블과 칼럼 이름이 모두 동일하기 때문에 식별을 위해 반드시 테이블 별칭을 사용해야 한다.

### :speech_balloon: 서브 쿼리

#### 1. 단일 행, 다중 행, 다중 칼럼 서브 쿼리

- 서브 쿼리란 하나의 SQL문 안에 포함되어 있는 또 다른 SQL문을 말한다.
- 서브 쿼리는 메인 쿼리의 칼럼을 모두 사용할 수 있지만 메인 쿼리는 서브 쿼리의 칼럼을 사용할 수 없다.
- 서브 쿼리 주의 사항
    - 서브 쿼리를 괄호로 감싸서 사용한다.
    - 서브 쿼리는 단일 행 또는 복수 행 비교 연산자와 함께 사용 가능하다. 단일 행 비교 연산자는 서브 쿼리의 결과가 반드시 1건 이하이어야 하고 복수 행 비교 연산자는 서브 쿼리의 결과 건수와 상관없다.
    - 서브 쿼리에서는 ORDER BY를 사용하지 못한다. ORDER BY절은 SELECT절에서 오직 한 개만 올 수 있기 때문에 ORDER BY절은 메인 쿼리의 마지막 문장에 위치해야 한다.
- 서브 쿼리가 SQL문에서 사용이 가능한 곳은 다음과 같다.
- SELECT -> FROM -> WHERE -> HAVING -> ORDER BY -> INSERT 문의 VALUES 절 -> UPDATE문의 SET 절
- 동작하는 방식에 따른 서브 쿼리 분류
    - Un-Correlated(비연관)서브 쿼리 : 서브 쿼리가 메인 쿼리 칼럼을 가지고 있지 않는 형태의 서브 쿼리이다. 메인 쿼리에 값을 제공하기 위한 목적으로 주로 사용한다.
    - Correlated(연관)서브 쿼리 : 서브 쿼리가 메인 쿼리 칼럼을 가지고 있는 형태의 서브 쿼리이다. 일반적으로 메인 쿼리가 먼저 수행 되어 읽혀진 데이터를 서브 쿼리에서 조건이 맞는지 확인 하고자 할 때 주로 사용 된다.
- 반환 되는 데이터의 형태에 따른 서브 쿼리 분류
    - Single Row 서브 쿼리(단일 행 서브 쿼리) : 서브 쿼리의 실행 결과가 항상 1건 이하인 서브 쿼리를 의미한다.
    - Multi Row 서브 쿼리(다중 행 서브 쿼리) : 서브 쿼리의 실행 결과가 여러 건인 서브 쿼리를 말한다.
    - Multi Column 서브 쿼리(다중 칼럼 서브 쿼리) : 서브 쿼리의 실행 결과로 여러 칼럼을 반환한다.

#### 2. 연관 서브 쿼리
- 연관 서브 쿼리는 서브 쿼리 내의 메인 쿼리 칼럼이 사용된 서브 쿼리이다.

#### 3. 그 밖에 위치에서 사용하는 서브 쿼리
- SELECT 절에 서브 쿼리 사용하기 -> 스칼라 서브 쿼리 사용(1개의 반환 값만 가진다.)
- FROM 절에 서브 쿼리 사용하기 -> 인라인 뷰 사용(동적으로 생성된 테이블인 것처럼 사용할수 있다.)
- HAVING 절에서 서브 쿼리 사용하기 -> 그룹 함수와 함께 사용될 때 그룹핑 된 결과에 대해 부가적인 조건을 주기 위해서 사용한다.

### :speech_balloon: 뷰(View)
- 테이블은 실제로 데이터를 가지고 있는 반면 뷰는 실제 데이터를 가지고 있지 않다.
- 뷰는 실제 데이터를 가지고 있지 않지만 테이블이 수행하는 역할을 수행하기 때문에 가상 테이블이라고도 한다.
- 뷰 사용의 장점
    - 독립성 : 테이블 구조가 변경 되어도 뷰를 사용하는 응용 프로그램은 변경하지 않아도 된다.
    - 편리성 : 복잡한 질의를 뷰로 생성함으로써 관련 질의를 단순하게 작성할 수 있다. 또한 해당 형태의 SQL문을 자주 사용할 때 뷰를 이용하면 편리하게 사용할 수 있다.
    - 보안성 : 직원의 급여 정보와 같이 숨기고 싶은 정보가 존재한다면, 뷰를 생성할 때 해당 칼럼을 빼고 생성함으로써 사용자에게 정보를 감출 수 있다.

### :speech_balloon: 그룹함수

#### 1, 데이터 분석 개요
- SQL 표준은 데이터 분석을 위해서 다음 세 가지 함수를 정의하고 있다.
    - AGGREGATE FUNCTION
    - GROUP FUNCTION
    - WINDOW FUNCTION

#### 2. ROLLUP 함수
- ROLLUP의 인수는 계층 구조이므로 인수 순서가 바뀌면 수행 결과도 바뀌게 되므로 인수의 순서에도 주의해야 한다.

#### 3. CUBE 함수
- ROLLUP에서는 단지 가능한 Subtotal만을 생성하였지만, CUBE는 결합 가능한 모든 값에 대하여 다차원 집계를 생성한다.

### :speech_balloon: WINDOW 함수

#### 1. 윈도우 함수 개요
- 기존 관계형 데이터베이스는 칼럼과 칼럼간의 연산, 비겨ㅛ, 연결이나 집합에 대한 집계는 쉬운 반면, 행과 행간의 관계를 정의하거나, 행과 행간을 비교, 연산하는 것을 하나의 SQL문으로 처리하는 것은 매우 어려운 문제였다.
- 그래서 행과 행간의 관계를 쉽게 정의하기 위해 만든 함수가 바로 윈도우 함수이다.

#### 2. 그룹 내 순위 함수(RANK)
- 랭크 함수는 ORDER BY를 포함한 쿼리 문에서 특정 항목에 대한 순위를 구하는 함수이다. 이때 특정 파티션 내에서 순위를 구할 수도 있고 전체 데이터에 대한 순위를 구할 수도 있다.
- DENSE_RANK : 랭크 함수와 흡사하나, 동일한 순위를 하나의 건수로 취급하는 것이 틀린 점이다.
- ROW_NUMBER 함수 : 동일한 값이라도 고유한 순위를 부여한다

#### 3. 그룹 내 행 순서 함수
- FIRST_VALUE : 파이션별 윈도우에서 가장 먼저 나온 값을 구한다.
- LIST_VALUE : 파티션별 윈도우에서 가장 나중에 나온 값을 구한다.
- LAG 함수 : 파티션별 윈도우에서 이전 몇 번째 행의 값을 가져올 수 있다.
- LEAD 함수 : 파티션별 윈도우에서 이후 몇 번째 행의 값을 가져올 수 있다.

#### 4. 그룹 내 비율 함수
- RATIO_TO_REPORT : 파티션 내 전체 SUM값에 대한 행별 칼럼 값의 백분율을 소수점으로 구할 수 있다.
- PERCENT_RANK : 파티션별 윈도우에서 제일 먼저 나오는 것을 0으로 제일 늦게 나오는 것을 1로 하여 값이 아닌 행의 순서별 백분율을 구한다.
- CUME_DIST 함수 : 파티션별 윈도우의 전체건수에서 현재 행보다 작거나 같은 건수에 대한 누적 백분율을 구한다.
- NTILE 함수 : 파티션별 전체 건수를 Argument 값으로 N 등분한 결과를 구할 수 있다.

### :speech_balloon: 절차형 SQL

#### 1. 절차형 SQL 개요
- 일반적인 개발 언어처럼 SQL에도 절차 지향적인 프로그램이 가능하도록 DBMS qpsejquffh PL등의 절차형 SQL을 제공하고 있다.
- 절차형 SQL을 이용하면 SQL문의 연속적인 실행이나 조건에 따른 분기처리를 이용하여 특정 기능을 수행하는 저장 모듈을 생성할 수 있다.

#### 2. PL/SQL 개요
- PL/SQL은 Block 구조로 되어있고 절차적 프로그래밍을 가능하게 하는 트랜잭셕 언어이다.
- PL/SQL 특징
    - PL/SQL은 Block 구조로 되어 있어 각 기능별로 모듈화가 가능하다.
    - IF, LOOP 등의 절차형 언어를 사용하여 절차적인 프로그램이 가능하도록 한다.
- 기본 문법
    - CREATE, DROP 사용해서 데이터베이스 내에 프로시저 생성

#### 3. T-SQL 개요
- T-SQL은 근본적으로 SQL 서버를 제어하기 위한 언어이다.
- 기본 문법
    - CREAT, DROP 사용해서 데이터베이스 내에 프로시저 생성

### :speech_balloon: Trigger 생성과 활용
- 트리거란 특정한 테이블에 DML문이 수행 되었을 대, 데이터베이스에서 자동으로 동작하도록 작성된 프로그램이다.

### :speech_balloon: 프로시저와 트리거의 차이점
- 프로시저
    - CREATE Procedure 문법 사용
    - EXECUTE 명렁어로 실행
    - COMMIT, ROLLBACK 실행 가능
- 트리거
    - CREATE Trigger 문법 사용
    - 생성 후 자동으로 실행
    - COMMIT, ROLLBACK 실행 안됨
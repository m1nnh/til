## Index (인덱스)

### 목적

`RDBMS` 즉 관계형 데이터베이스에서, 검색 속도를 높이기 위한 기술이다. 책의 목차와 비슷한 역할을 한다고 생각하면 편하다. 데이터베이스 안의 `Entity`를 처음부터 풀 스캔하지 않고, `B+ Tree`로 구성된 구조에서 `Index` 파일 검색으로 속도를 향상시키는 기술이다.

### 파일의 구성 

테이블 생성 시, 3가지 파일이 생성된다.

- FRM : 테이블 구조 저장 파일 (ERD)
- MYD : 실제 데이터 파일
- MYI : Index 정보 파일 (Index 사용 시 생성)

사용자가 쿼리를 통해 Index를 사용하는 칼럼을 검색하게 되면, 이때 `MYI` 파일의 내용을 활용한다.

### 단점

단점은 파일의 개수가 하나 늘어나는 것이기 때문에 그것을 생각해서 생각해보면 된다.

- Index 생성시, .mdb 파일 크기가 증가한다.
- 한 페이지를 동시에 수정할 수 있는 병행성이 줄어든다.
- 인덱스 된 속성에서 Data를 업데이트 하거나, Entity를 추가 또는 삭제시 성능이 떨어진다.
    - 이유는, 파일 두개에 추가를 하거나, 파일 두개를 업데이트 해야하기 때문이다.
- 데이터 변경 작업이 자주 일어나는 경우, Index를 재작성해야 하므로 성능에 영향을 미친다.

따라서 어느 속성을 인덱스 해야 하는지 미리 시험해 보고 결정하는 것이 좋다. 인덱스를 추가하면 쿼리 속도가 1초 정도 빨라지지만, 데이터 행을 추가하는 속도는 2초 정도 느려지게 되어 여러 사용자가 사용하는 경우 Entity 잠금 문제가 발생할 수 있다.

### 장점

- 키 값을 기초로 하여 테이블에서 검색과 정렬 속도를 향상시킨다.
- 질의나 보고서에서 그룹화 작업의 속도를 향상시킨다.
- 인덱스를 사용하면 테이블 행의 고유성을 강화시킨다.

### 상황 분석

- 사용하면 좋은 경우
    - Where 절에서 자주 사용되는 컬럼
    - 외래키가 사용되는 컬럼
    - 조인에 자주 사용되는 컬럼
- 사용하면 안좋은 경우
    - 데이터 중복도가 높은 컬럼
    - DML (Insert, Delete, Update)이 자주 일어나는 컬럼

### DML이 일어났을 때의 상황

- Insert 
    - 새로운 블락을 할당 받은 후, Key를 옮기는 작업을 수행한다.
    - Index split 작업 동안, 해당 Block Key 값에 대해서 DML이 블로킹 된다. (대기 이벤트 발생)
- Delete
    - 테이블에서 데이터가 삭제되는 경우 : 데이터가 지워지고, 다른 데이터가 그 공간을 사용 가능하다.
    - 인덱스에서 데이터가 삭제되는 경우 : 데이터가 지워지지 않고, Null 값 표시만 해둔다.
- Update
    - 테이블에서 업데이트가 발생하면 인덱스는 업데이트 할 수 없다. 
    - 인덱스에서는 삭제가 발생한 후, 새로운 작업의 Insert 작업을 해야한다. / 2배의 작업이 소요

    
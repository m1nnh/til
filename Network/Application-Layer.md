## 네트워크 서비스와 애플리케이션 계층

### 애플리케이션 계층의 역할

`애플리케이션 계층`은 `웹`이나 `이메일`과 같은 서비스를 제공하는 계층이다. 각 서비스는 자신만의 독자적인 `프로토콜`을 가지고 있다. 네트워크 계층 모델 중 트랜스포트 이하의 계층들은 데이터 전송을 담당하고 있으므로 이들 데이터 전송 관련 계층을 제외한 모든 영역이 애플리케이션 계층의 범주라고 보면 된다.

#### 사용자가 직접 사용하는 프로토콜

애플리케이션 계층의 대표적인 프로토콜은 사용자가 자주 이용하는 서비스에서 쉽게 찾아 볼 수 있다.

- HTTP : 웹 클라이언트와 웹 서버 사이에서 웹 페이지 데이터를 주고받는다.
- SMTP, POP, IMAP : 메일을 송수신하고 보관한다.
- SMB, AFP : LAN 안에서 파일을 공유한다.
- FTP : 서버를 통해 파일을 주고받는다.
- Telnet, SSH : 원격에서 서버를 제어한다.

#### 사용자가 간접적으로 사용하는 프로토콜

애플리케이션 계층의 프로토콜 중에는 사용자가 직접 사용하지 않아서 체감할 수 없는 프로토콜들도 있다. 이러한 프로토콜들은 OS나 다른 애플리케이션 계층의 프로토콜들이 간접적으로 사용하는데, 주로 인터넷이나 LAN의 원활한 사용을 위해 사용자에게 보이지 않는 이면에서 동작한다.

- DNS : 도메인명과 IP 어드레스의 정보를 서로 변환할 때 사용한다.
- DHCP : LAN 내의 컴퓨터에게 IP 어드레스를 할당할 때 사용한다.
- SSL/TLS : 통신 데이터를 암호화하여 주요 정보를 안전하게 주고받을 때 사용한다.
- NTP : 네트워크에 연결된 장비들의 시스템 시간을 동기화할 때 사용한다.
- LDAP : 네트워크에 연결된 자원(사용자, 장비들)의 통합 관리에 필요한 디렉터리 서비스를 제공할 때 사용한다.

### 웹 페이지를 전송하는 HTTP

인터넷에서 사용되는 서비스 중 가장 대표적인 `WWW(World Wide Web)`는 HTTP라는 프로토콜을 사용한다. `웹 브라우저`가 `웹 서버`로 특정 `웹 페이지`를 요청하면 웹 서버가 해당 페이지의 내용을 `HTML` 형식으로 응답한다. 웹 브라우저는 이 데이터를 해석하여 웹 페이지 화면을 그린 후 사용자에게 보여준다.

- 보고 싶은 웹 페이지의 URL을 요청한다 (Client)
- 웹 페이지의 HTML 파일을 응답한다. (Server)
- HTML 내용을 확인한 결과, 추가로 CSS나 JPEG가 필요하면 해당 파일을 받기 위해 새로운 요청을 보낸다. (Client)
- 응답으로 받은 HTML, CSS, JPEG, JS 파일들을 조합해서 웹 페이지를 표시한다.

클라이언트 PC의 웹 브라우저와 웹 서버는 `HTTP(HyperText Transfer Protocol)`이라는 애플리케이션 계층의 프로토콜을 사용한다. 통신 과정에서 주고받은 정보들은 HTTP 메시지라고 부르고, 크게 `요청`과 `응답`의 두 가지 형태로 구분된다.

- URL을 입력한다.
- 요청을 보낸다.
- 요청에 대한 응답을 보낸다.
- 웹 페이지를 표시한다.

HTTP는 통신 시 정보를 한 번씩 주고받은 후 바로 끊는 형태로 처리된다. 이렇게 상태 정보를 저장하지 않는 통신 형태를 `스테이트리스(stateless)`라고 한다. HTTP는 대표적인 `무상태 프로토콜`이다. 

### GET 방식과 POST 방식

HTML 입력 폼을 통해 HTML 요청을 보낼 때 주로 `GET 방식`과 `POST 방식`의 두 종류의 요청 방식을 많이 사용한다. 이들 요청 방식은 각각 사용하는 용도와 특징이 다르기 때문에 웹 서비스의 기능에 따라 구분해서 사용해야만 한다. GET 방식은 정보를 요청하고, POST 방식은 정보를 저장하거나 변경할 때 사용하며 상대적으로 더 많은 데이터를 전송할 수 있다. POST 방식은 GET 방식처럼 입력 폼의 내용이 육안으로 쉽게 노출되지는 않지만, 전송한 메시지를 해석하면 내용이 노출되기 때문에 보안상 안전하다고 할 수 없다.

### 쿠키 세션

HTTP는 기본적으로 무상태 프로토콜이다. 하지만 상태를 유지하면서 연속된 응답을 해야 할 때 `쿠키`라는 기술을 사용한다.

- 처음 접속을 하는 경우 요청에 대한 응답에 쿠키를 함께 보낸다.
- 쿠키가 클라이언트 PC에 저장된다.
- 다음 요청부터 메시지를 보낼 때 쿠키를 함께 보낸다.
- 쿠키를 보고 같은 사용자의 요청인지 판단한다.

유출되었을 때 보안 문제가 생길 만한 정보는 클라이언트 PC의 쿠키에 저장하지 말아야 한다. 기본적으로 각종 정보는 서버 쪽에 저장하는 것이 원칙이고, 동일한 사용자인지 확인하기 위한 `세션 ID` 등의 식별 정보만 클라이언트에 쿠키로 저장하도록 제한해야 한다.

- 사용자 계정명과 패스워드를 입력해서 로그인한다. (Client)
- 세션 ID를 발급한 후에 응답 메시지에 포함해서 보낸다. (Server)
- 세션 ID가 일치하므로 로그인된 사용자와 동일한 사용자로 간주한다.

### 이메일

이메일을 송수신할 때는 `SMTP`, `POP`, `IMAP`와 같은 여러 프로토콜이 사용된다. 발신할 때 사용하는 SMTP(Simple Mail Transfer Protocol)와 수신할 때 사용하는 POP(Post Office Protocol)이 있다. 그래서 메일 발신자는 SMTP를 사용하여 수신자의 메일 서버로 메일을 보내고, 메일 수신자는 POP을 사용해서 메일 서버로부터 자신의 메일을 받아 온다.

SMTP 프로토콜은 클라이언트 PC가 메일 서버로 메일을 보낼 때만 사용되는 것이 아니라, 발신자의 메일 서버에서 수신자의 메일 서버로 메일을 중계할 때도 사용된다. HTTP 프로토콜과는 달리 상태를 가지는 스테이트풀(stateful) 프로토콜이기 때문에 전송 종료 명령이 보내져야 통신을 종료한다.

- 접속 요청 -> 접속 OK
- Mail From 송신자 주소 -> OK
- RCPT To 수신자 주소 -> OK
- 메일 데이터 전송 -> OK
- 종료 -> OK

송신자, 수신자, 메일 정보를 순차적으로 전송한다. 상태를 유지하는 프로토콜이기 때문에 종료 명령이 전달되기 전까지는 통신이 계속 유지된다.

#### 이메일을 수신하는 POP

SMTP 프로토콜을 통해 전송된 메일은 최종적으로 수신자의 메일 서버에 저장된다. 이후 메일 서버에 저장된 메일을 확인할 때는 `POP` 프로토콜을 사용한다. 메일을 수신하는 것 외에도 수신한 메일 건수나 용량 확인, 메일 삭제와 같은 처리에도 POP 프로토콜을 사용한다.

- 접속 요청
- User 사용자 이름 -> OK
- Password 패스워드 -> OK
- Stat / List / UIDL -> 메일 건수나 용량
- RETR 메시지 번호 -> 메일 데이터
- 종료 -> OK

POP은 사용자 인증을 먼저 한 후에 메일과 관련된 통신을 시작한다.

### PC끼리 파일 공유하기

파일 공유는 개인 컴퓨터에 공유 디렉터리를 만든 후, 그 안에 공유할 파일을 저장하여 여러 사람이 함께 활용할 수 있도록 만드는 서비스이다. 개인 컴퓨터에서 많이 사용되는 `파일 공유`는 공유에 참여하는 각각의 컴퓨터가 서로 서버가 되기도 하고 클라이언트가 되기도 하는 `피어 투 피어(P2P, Peer To Peer)` 방식을 사용한다.

파일 공유는 피어 투 피어 방식이기 때문에 중앙에서 관리하는 서버가 없다. 처음에는 LAN에 연결된 컴퓨터들 중 어떤 컴퓨터가 공유를 하고 있는지 알 방법이 없기 때문에 일단 컴퓨터가 네트워크에 연결되면 다른 모든 컴퓨터에게 자신이 연결되었다는 것을 통보하게 된다. 이때 통보를 받은 컴퓨터는 자신의 정보를 응답으로 알려주게 되고, 결과적으로 네트워크 전체에서 공유 가능한 컴퓨터들을 서로 식별할 수 있게 된다. 파일 공유 프로토콜은 OS마다 서로 다르다.

### 파일을 전송하는 FTP

`FTP(File Transfer Protocol)`는 파일 전송 프로토콜이다. LAN에서는 파일 공유와 같은 더 간단한 파일 전송 방법이 있기 때문에 주로 인터넷에 연결된 서버에 파일을 전송할 때 사용된다. 명령어를 사용해서 파일을 업로드하거나 다운로드하고, 디렉터리를 만들거나 파일을 삭제하기도 한다.

FTP에서는 크게 파일을 주고받기 위한 `데이터 커넥션`과 명령어를 보내기 위한 `컨트롤 커넥션`의 두 가지 접속 형태를 사용한다. 이렇게 접속 형태가 분리되어 있으면 파일 전송 중에도 명령을 줄 수 있어서 전송 중인 파일을 중단시키는 것이 가능하다. FTP 서비스에서는 서버 내부에서 외부로 나가는 통신을 방화벽이 차단하여 파일 전송이 안 되는 경우가 발생하기도 하는데, 이때는 `패시브 모드(Passive Mode)`를 사용해서 클라이언트 쪽에서 서버 쪽으로 역방향으로 데이터 커넥션을 만들어 주면 파일을 전송할 수 있게 된다. 엑티브 모드와 패시브 모드의 차이점은 단지 누가 접속을 만드느냐에 불과하지만, 이 차이가 보안 수준과 데이터 전송 가능 여부를 좌우하게 된다.

### 원격지의 컴퓨터 제어하기

원격지의 컴퓨터를 제어하는 방법으로는 `CLI(Commend Line Interface)`와 같은 명령 프롬프트를 통해 명령어로 제어하는 방법과 `GUI(Graphical User Interface)`를 통해 제어하는 방법이 있다. `Telnet`이나 `SSH(Secure SHell)`는 원격지의 컴퓨터를 명령어로 제어하기 위한 프로토콜이다. 서버들은 데이터 센터와 같이 먼 곳에 설치되어 있는 경우가 많기 때문에 서버를 관리할 때는 Telnet이나 SSH를 사용하는 것이 일반적이다. Telnet이나 SSH는 윈도우의 명령 프롬프트에서 명령을 내리면 그 내용을 그대로 서버로 전달하는데, 명령에 대한 결과가 다시 텍스트로 표시 되어 마치 서버 앞에 앉아 있는 것처럼 작업할 수 있다. 

### Voice over IP와 영상 스트리밍

인터넷에서 음성이나 동영상을 보낼 때는 데이터를 압축하거나 분할해서 보낸다. 인터넷 전화 서비스로는 스카이프나 라인 등이 대표적이고, 스마트폰에서는 LTE와 함께 `VoIP(Voice over IP)` 기술이 사용되기도 한다. 음성이나 동영상 데이터는 메일과 같은 텍스트 형태의 정보에 비해 상대적으로 데이터 용량이 크기 때문에 통신의 신뢰성보다는 **전송 속도를 우선**하는 `UDP`를 사용하고, 전송 시에는 데이터를 압축하되 수신된 정보를 바로 재생할 수 있는 `스트리밍(Streaming)` 기술을 사용한다.

음성이나 동영상을 주고받는 서비스는 중간에 서버를 경유하지 않고 컴퓨터나 스마트폰끼리 직접 통신하는 피어 투 피어 방식을 사용하는 것이 일반적이다. 다만, 피어 투 피어 방식은 서로 통신할 상대를 찾는 것이 어렵기 때문에 우선 클라이언트 서버 방식으로 디렉터리 서버에 접속하여 상대를 찾은 다음, 상대방과 통화할 대 피어 투 피어 방식으로 직접 통신하는 `하이브리드(Hybrid)` 방식도 많이 활용된다.


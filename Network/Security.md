## 보안

### 네트워크와 보안

네트워크에는 여러 컴퓨터를 연결하여 데이터를 자유롭게 주고받을 수 있게 해 주는 장점이 있는 반면, 악의적인 사용자로부터 데이터를 탈취당할 수 있는 잠재 위험도 잇다. 네트워크에서 발생할 수 있는 보안 위협으로는 `정보 유츌`, `사용자 신분 사칭`, `데이터 위변조`와 같은 형태가 있다.

정보 유출에 대한 방어책으로 데이터 `암호화`가 있다. 암호화된 데이터는 제3자에게 유출되었다고 하더라도 내용을 식별할 수 없다. 암호화를 할 때에는 열쇠 역할을 하는 키(key)가 사용되는데, 키의 관리 방식에 따라 크게 `공유 키 암호화`, `공개 키 암호화`의 두 가지 방식이 많이 활용되고 있다. 신분 사칭을 막기 위한 방법으로는 `전자 인증서`가 있고, 데이터의 위변조를 막기 위한 방법으로는 `전자 서명`이 있다.

### 공유 키와 공개 키

암호화는 데이터를 이해하기 어렵게 만드는 과정을 의미하고, 보안을 위해 할 수 있는 기본 기술 중 하나다. 이때 단순히 암호화를 하여 읽기 어렵게 만드는 것으로 끝나는 것이 아니라 그 내용을 다시 원상태로 만들어 읽을 수 있어야 하는데, 그 과정을 `복호화`라고 한다. 암호와의 복화를 아무나 하지 못하도록 하기 위해서 비밀번호 같은 것을 사용하는데, 이것을 `키(key)`라고 한다. `공유 키 암호화` 방식에서는 하나의 키를 사용해서 암호화도 하고 복호화도 한다.

공유 키 암호화 방식은 처리 방식이 간단하고 암호화와 복호화를 하는 속도가 빠르다는 장점이 있지만, 키를 안전하게 공유하는 방법이 다소 어려울 수 있다. 예를 들어, 키가 되는 패스워드를 이메일로 보낸다고 하자. 이 이메일이 유출되면 누구나 간단히 복호화를 할 수 있을 것이다. 그리고 암호화한 데이터를 공유할 모든 사람에게 같은 키를 나눠 줘야 하는 것이 관리 측면에서 적지 않은 부담이 될 수 있다.

#### 공개 키

`공개 키 암호화` 방식은 암호화를 하는 키와 복호화를 하는 키를 각각 만들어 한 세트로 관리하는 방식이다. 한쪽 키로 암호화한 것은 다른 한 키로만 복호화를 할 수 있는데, 두 개의 키 중 하나는 자신이 가지고 다른 하나는 통신 상대에게 나눠 주게 된다. 이때 자신이 가지는 키를 `비밀 키` 혹은 `개인 키`라고 하고, 다른 사람에게 공개하는 키를 `공개 키`라고 한다.

공개 키 암호로 데이터를 주고받을 경우, 먼저 상대에게 자신의 공개 키를 사전에 전달해 둔다. 이후 상대는 데이터를 보내고 싶을 대 미리 받은 공개 키로 데이터를 암호화하여 보내는데, 이 데이터를 받은 쪽은 자신의 개인 키로 데이터를 복호화할 수 있다.

![](https://raonctf.com/static/essential/images/crypto/crypto_asymmetric_key_01.jpg)

사진 출처 : [https://raonctf.com/essential/study/web/asymmetric_key](https://raonctf.com/essential/study/web/asymmetric_key)

- 메일로 공개키를 보낸다.
- 개인 키로 복호화한다.
- 공개 키로 암호화한다.
- 공개 키를 가지고 있어도 복호화할 수 없으므로 아무 소용없다.

### 전자증명서와 전자 서명

공개 키 암호화 방식을 사용하면 데이터 유출을 막을 수는 있지만, 공개 키를 보낸 사람이 엉뚱한 사람이라면 누군지도 모르는 사람에게 데이터를 넘겨줄 수 있는 잠재 위험이 있다. 그래서 인터넷에서 데이터를 주고받을 대는 본인이 자기 자신임을 증명할 수 있는 수단이 필요하다. 신분 사칭이나 메일 내용의 위변조를 막는 방법으로 인증 기관이 발행한 `전자 인증서`를 사용할 수 있다. 발급받은 전자 인증서 안에는 공개 키와 인증 기관의 전자 서명이 포함되어 있다. 이 `전자 서명`은 인증 기관이 '이 공개 키는 이 소유자의 것이다'라는 것을 보증하는 역할을 한다. 그래서 이 인증서를 가진 사람은 증명서에 포함된 공개 키를 사용해서 암복호화를 할 수 있게 된다.

- 공개 키와 소유자 정보를 보내서 전자 인증서 발행을 의뢰한다.
- 전자 인증서를 발행한다.

#### PKI

공개 키나 전자 인증서 등의 보안 인프라를 통틀어 `공개 키 기반 구조(PKI, Public Key Infrastructure)`라고 한다. 주의할 것은 공개 키 기반 구조가 보안 취약점의 많은 부분을 제거해 주기는 하나, 피싱 사이트로 인한 금융 사기나 컴퓨터 바이러스로 인한 보안 위협 등에 대해서는 대응 가능한 영역이 아니기 때문에 막을 수 없다는 것이다.

#### 전자 서명

`전자 서명`은 데이터 내용이 위변조 되지 않았다는 것과 누가 보낸 것인지를 보증하는 역할을 한다. 전자 인증서에도 인증 기관의 전자 서명이 포함되어 있는데, 사용자가 어떤 데이터를 보낼 때 위변조 되지 않았음을 증명할 때 사용할 수도 있다. 전자 서명을 만들기 위해서는 원본 데이터의 해시 값을 구한 후, 이것을 공개 키가 아닌 개인 키로 암호화하면 된다.

![image](https://user-images.githubusercontent.com/78870076/124426050-70191880-dda4-11eb-94f5-9d389c0a47e1.png)

사진 출처 : [https://haloes.tistory.com/75](https://haloes.tistory.com/75)

#### 해시

해시는 특수한 알고리즘을 사용하여 데이터를 요약하는 것을 말한다. 전자 서명에 사용되는 해시는 '원본 데이터가 똑같다면 해시 결과도 똑같다'. '해시 결과에서 원본 데이터를 복원할 수 없다'라는 특징을 가지고 있다. 그래서 원본 데이터를 모르는 상태에서도 해시 값만 비교하여 원본 데이터의 일치 여부를 확인할 수 있다.

### SSL/TLS

`SSL(Secure Sockets Layer)` 혹은 `TLS(Transport Layer Security)`는 서버와 클라이언트 사이의 통신 구간에 대해서 보안 수준을 높이기 위한 프로토콜이다. 인증 기관에서 발행된 서버 인증서를 사용해서 서버를 증명하고, 통신 구간을 암호화하며, 데이터의 위변조를 막는다.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbfEg93%2Fbtq3TgTGS2B%2FIocSKvTIAwD0KzUiYWJJh0%2Fimg.png)

사진 출처 : [https://sangminlog.tistory.com/entry/ssl-tls?category=872762](https://sangminlog.tistory.com/entry/ssl-tls?category=872762)

HTTPS도 TCP 기반의 프로토콜이기 때문에 위 사진에서 파란색으로 표시된 것처럼 `3-way handshake` 과정을 통해 가상 연결을 확립한 후 `SSL handshake` 과정이 이루어진다.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FwBDR6%2Fbtq3TXlOAz0%2FFLg2iknw7tnMhXFESzQSNk%2Fimg.png)

사진 출처 : [https://sangminlog.tistory.com/entry/ssl-tls?category=872762]

- 클라이언트 -> 서버로 랜덤 데이터와 사용 가능한 암호화 방식을 보낸다.
- 서버 -> 클라이언트로 랜덤 데이터, 사용할 암호화 방식과 SSL 인증서를 보낸다.
- 클라이언트는 서버에게 받은 인증서의 CA가 자신이 들고 있는 CA 리스트에 있는지 확인하고, 있다면 CA의 공개키로 복호화한다. 이는 곧 CA 비밀키에 의해 암호화됐다는 것이므로 인증서의 신원을 보증해준다. (공개키 암호화 방식) 
- 클라이언트는 자기가 보낸 랜덤 데이터와 서버로부터 받은 랜덤 데이터를 조합하여 임시 키 (pre master secret key)를 만든다.
- 만들어진 임시 키를 인증서의 공개키로 암호화하여 서버에게 보낸다.
- 서버는 자신이 들고 있던 비밀키로 임시 키를 복호화한다.
- 이로써 클라이언트와 서버는 동일한 임시 키를 공유하게 되는데, 일련의 과정을 거쳐 master secret 값을 만들고 세션 키를 생성한다.
- 이렇게 만들어진 세션 키로 암호화된 데이터를 주고받는다. (대칭키 암호화 방식)
- 세션이 종료되면 클라이언트와 서버 모두 세션 키를 폐기한다.

이렇게 공개키 암호화 방식과 대칭키 암호화 방식을 조합해서 사용하는 이유는 아래와 같다.

- 공개키 방식은 컴퓨터 파워를 많이 사용한다. 그래서 요청이 쏠리는 경우 서버는 과금을 내야 한다.
- 대칭키 방식은 암호를 푸는 열쇠인 대칭키를 상대방에게 줘야 한다. 하지만 인터넷을 통해 키를 전송하는 것은 위험하다.

그래서 채널을 수립할 때에는 공개키 방식을 이용해 보다 안전한 채널을 수립하고, 이후 데이터를 주고받을 때 대칭키를 통해 암호화하여 주고받는다.

### SSH

`SSH(Secure Shell)`는 원격지에 있는 서버를 제어하기 위해 만들어진 telnet을 대체하는 프로토콜이다. SSL과 마찬가지로 공개 키와 공유 키를 조합한 방식으로 통신을 암호화한다. 전자 인증서는 사용하지 않는 대신 서버나 클라이언트가 만든 공개 키를 사용한다. 인증 방식으로는 `패스워드 인증`이나 `공개 키 인증` 등을 사용할 수 있다.

![image](https://user-images.githubusercontent.com/78870076/124426999-c6d32200-dda5-11eb-90d0-419aab6adbf2.png)

사진 출처 : [https://brunch.co.kr/@sangjinkang/52](https://brunch.co.kr/@sangjinkang/52)
